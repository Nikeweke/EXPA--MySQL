(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{185:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"ex-of-creating-triggers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ex-of-creating-triggers","aria-hidden":"true"}},[s._v("#")]),s._v(" Ex. of creating triggers")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("/************************************************************\n*  Триггер с 1 коммандой\n*\n***********************************************************/")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("ins_employees"),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("AFTER")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("employees"),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v("\n   "),a("span",{attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" trigga "),a("span",{attrs:{class:"token keyword"}},[s._v("Set")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'insert in employees'")]),s._v("\n\n\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/************************************************************\n*  Триггер с 2 коммандами (Связь между двумя таблами на удаление) (после каждой комманды ставить - ;)\n*\n***********************************************************/")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("//")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("del_emp1"),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("BEFORE "),a("span",{attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("employees"),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" log "),a("span",{attrs:{class:"token keyword"}},[s._v("Set")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("action")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'delete in employees'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" kod "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" kod"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" OLD"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("//")]),s._v("\n\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/************************************************************\n*  Удаление первой записи\n*\n***********************************************************/")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("DELETE")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" trigga "),a("span",{attrs:{class:"token keyword"}},[s._v("LIMIT")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("/************************************************************\n*  Триггер с IF clause\n*\n***********************************************************/")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" $$\n"),a("span",{attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("TRIGGER")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("likes_recounter"),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("AFTER")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v("likes"),a("span",{attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("FOR EACH ROW")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("DECLARE")]),s._v(" likes_count "),a("span",{attrs:{class:"token keyword"}},[s._v("integer")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n "),a("span",{attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("article_id "),a("span",{attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("-- INSERT INTO logs (table_name, user) VALUES(NEW.article_id, 'here');")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("@likes_count")]),s._v(" :"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("count")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" likes "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" article_id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("article_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" articles "),a("span",{attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" likes "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("@likes_count")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" articles"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("article_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("IF")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  \n "),a("span",{attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("answer_id "),a("span",{attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("-- INSERT INTO logs (table_name, user) VALUES(NEW.article_id, 'here1');")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("@likes_count")]),s._v(" :"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("count")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" likes "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" answer_id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("answer_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" answers "),a("span",{attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" likes "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("@likes_count")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" answers"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("answer_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("IF")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n\n \n  "),a("span",{attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("question_id "),a("span",{attrs:{class:"token operator"}},[s._v("<>")]),s._v(" "),a("span",{attrs:{class:"token number"}},[s._v("0")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("THEN")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("BEGIN")]),s._v("\n    "),a("span",{attrs:{class:"token comment"}},[s._v("-- INSERT INTO logs (table_name, user) VALUES(NEW.article_id, 'here2');")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("@likes_count")]),s._v(" :"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("count")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("*")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" likes "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" question_id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("question_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" articles "),a("span",{attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" likes "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("@likes_count")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" question"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" NEW"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("question_id"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("IF")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   \n    "),a("span",{attrs:{class:"token comment"}},[s._v("-- INSERT INTO logs (table_name, user) VALUES(NEW.article_id, 'here3');")]),s._v("\n    \n"),a("span",{attrs:{class:"token keyword"}},[s._v("END")]),s._v("\n$$\n"),a("span",{attrs:{class:"token keyword"}},[s._v("DELIMITER")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])}],!1,null,null,null);e.options.__file="create-triggers.md";t.default=e.exports}}]);